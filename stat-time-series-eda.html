<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: 데이터 과학 – 기초 통계</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-17', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">데이터 과학 – 기초 통계</h1></a>
          <h2 class="subtitle">시계열 모형 식별 도구</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="학습-목표"><span class="glyphicon glyphicon-certificate"></span>학습 목표</h2>
</div>
<div class="panel-body">
<ul>
<li>시계열 데이터 사전 분석 도구를 살펴본다.</li>
<li>시계열 데이터 시각화 및 (자기)상관 도구를 실습한다.</li>
</ul>
</div>
</section>
<h2 id="금융-시계열-데이터-yahoo-finance-data">금융 시계열 데이터 <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></h2>
<p>금융 시계열 데이터, 특히 주식관련 데이터는 <a href="https://finance.yahoo.com/">야후 파이낸스</a> 통해서 신뢰성 높은 데이터를 빠른 시간내 획득할 수 있다.</p>
<h3 id="금융-시계열-데이터-분석환경">금융 시계열 데이터 분석환경</h3>
<p>금융 시계열 데이터로 작업을 할 경우 가장 먼저 시계열 데이터를 조작해야 되는데, 이런 경우 <code>zoo</code> 를 확장한 <code>xts</code> 팩키지를 많이 사용한다. 정적 시계열 데이터 시각화에는 <code>ggplot2</code> 팩키지, 동적 시계열 데이터 시각화에는 <code>dygraphs</code> 팩키지를 장착하여 활용한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;xts&quot;, repos=&quot;http://cloud.r-project.org&quot;)</span>
<span class="co"># install.packages(&quot;xtsExtra&quot;, repos=&quot;http://R-Forge.R-project.org&quot;)</span>
<span class="co"># 환경설정 </span>
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(xts)
<span class="kw">library</span>(dygraphs)</code></pre></div>
<pre class="output"><code>Error in library(dygraphs): there is no package called &#39;dygraphs&#39;
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(extrafont)
<span class="kw">library</span>(xtsExtra)</code></pre></div>
<pre class="output"><code>Error in library(xtsExtra): there is no package called &#39;xtsExtra&#39;
</code></pre>
<h3 id="금융-데이터-가져오기">금융 데이터 가져오기</h3>
<p>금융 데이터를 가져올 때 <code>http://real-chart.finance.yahoo.com/table.csv?s=005930.KS&amp;a=01&amp;b=01&amp;c=2015&amp;d=12&amp;e=31&amp;f=2015&amp;g=d&amp;ignore=.csv</code> url에서 삼성전자(005930.KS), 네이버 NHN(035420.KS)을 지정하고 기간정보를 적절히 설정하여 넘겨준다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 야후 금융데이터 -----------------------------------------------------------</span>
<span class="co"># https://finance.yahoo.com/</span>

<span class="co"># 삼성과 네이버 주식시세</span>
samsung_url &lt;-<span class="st"> &quot;http://real-chart.finance.yahoo.com/table.csv?s=005930.KS&amp;a=01&amp;b=01&amp;c=2015&amp;d=12&amp;e=31&amp;f=2015&amp;g=d&amp;ignore=.csv&quot;</span>
naver_url   &lt;-<span class="st"> &quot;http://real-chart.finance.yahoo.com/table.csv?s=035420.KS&amp;a=01&amp;b=01&amp;c=2015&amp;d=12&amp;e=31&amp;f=2015&amp;g=d&amp;ignore=.csv&quot;</span>

yahoo.read &lt;-<span class="st"> </span>function(url){
  dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(url,<span class="dt">header=</span><span class="ot">TRUE</span>,<span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)
  df &lt;-<span class="st"> </span>dat[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)]
  df$Date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">as.character</span>(df$Date))
  <span class="kw">return</span>(df)
}

samsung &lt;-<span class="st"> </span><span class="kw">yahoo.read</span>(samsung_url)
naver  &lt;-<span class="st"> </span><span class="kw">yahoo.read</span>(naver_url)</code></pre></div>
<h3 id="금융-데이터-시각화-단변량">금융 데이터 시각화: 단변량</h3>
<p>정적 그래프를 통해 시각화하는 경우 <code>ggplot</code>, 인터랙티브 동적 그래프를 통해 시각화하는 경우 <code>dygraphs</code> 를 활용한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 주식시세 시각화 -------------------------------------------------------------</span>
<span class="co"># 정적 시각화</span>

<span class="kw">ggplot</span>(samsung, <span class="kw">aes</span>(Date,Close)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span><span class="st">&quot;samsung&quot;</span>)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span>naver,<span class="kw">aes</span>(<span class="dt">color=</span><span class="st">&quot;naver&quot;</span>)) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">color=</span><span class="st">&quot;Legend&quot;</span>) +
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;samsung&quot;</span>, <span class="st">&quot;naver&quot;</span>),
                          <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;brown&quot;</span>)) +
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">&quot;삼성전자, 네이버 종가&quot;</span>,
    <span class="dt">x=</span> <span class="st">&quot;날짜&quot;</span>,
    <span class="dt">y=</span><span class="st">&quot;주가&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">lineheight=</span>.<span class="dv">7</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">family=</span><span class="st">&quot;NanumGothic&quot;</span>))</code></pre></div>
<p><img src="fig/time-series-financial-data-viz-1.png" title="plot of chunk time-series-financial-data-viz" alt="plot of chunk time-series-financial-data-viz" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 동적 시각화</span>
samsung_xts &lt;-<span class="st"> </span><span class="kw">xts</span>(samsung$Close,<span class="dt">order.by=</span>samsung$Date,<span class="dt">frequency=</span><span class="dv">365</span>)
naver_xts &lt;-<span class="st"> </span><span class="kw">xts</span>(naver$Close,<span class="dt">order.by=</span>naver$Date,<span class="dt">frequency=</span><span class="dv">365</span>)

korea_stocks &lt;-<span class="st"> </span><span class="kw">cbind</span>(samsung_xts, naver_xts)
<span class="kw">names</span>(korea_stocks) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Samsung&quot;</span>, <span class="st">&quot;Naver&quot;</span>)

<span class="kw">dygraph</span>(korea_stocks, <span class="dt">ylab=</span><span class="st">&quot;종가&quot;</span>, 
        <span class="dt">main=</span><span class="st">&quot;삼성전자, 네이버 종가&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">dySeries</span>(<span class="st">&quot;Samsung&quot;</span>,<span class="dt">label=</span><span class="st">&quot;삼성전자&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">dySeries</span>(<span class="st">&quot;Naver&quot;</span>,<span class="dt">label=</span><span class="st">&quot;네이버&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">dyOptions</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;green&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">dyRangeSelector</span>()</code></pre></div>
<pre class="output"><code>Error in eval(expr, envir, enclos): 함수 &quot;dygraph&quot;를 찾을 수 없습니다
</code></pre>
<h3 id="시계열-데이터-산점도">시계열 데이터 산점도</h3>
<p>네이버와 삼성전자 두 기업 주가 및 일별 수익률을 산점도로 찍어보면 상관관계를 확인할 수 있다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 상관계수 -------------------------------------------------------------------</span>

korea_stock_df &lt;-<span class="st"> </span><span class="kw">left_join</span>(samsung, naver, <span class="dt">by=</span><span class="st">&quot;Date&quot;</span>)
<span class="kw">names</span>(korea_stock_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Samsung&quot;</span>, <span class="st">&quot;Naver&quot;</span>)

<span class="kw">plot</span>(korea_stock_df$Date, korea_stock_df$Samsung, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">100000</span>, <span class="dv">2000000</span>), <span class="dt">main=</span><span class="st">&quot;삼성전자, 네이버 종가&quot;</span>)
<span class="kw">lines</span>(korea_stock_df$Date, korea_stock_df$Naver, <span class="dt">col=</span><span class="st">&quot;darkgreen&quot;</span>)</code></pre></div>
<p><img src="fig/time-series-yahoo-scatterplot-1.png" title="plot of chunk time-series-yahoo-scatterplot" alt="plot of chunk time-series-yahoo-scatterplot" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 산점도</span>
<span class="kw">plot</span>(korea_stock_df$Samsung, korea_stock_df$Naver)
<span class="kw">abline</span>(<span class="dt">coef=</span><span class="kw">coef</span>(<span class="kw">lm</span>(korea_stock_df$Naver~korea_stock_df$Samsung)), <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>)</code></pre></div>
<p><img src="fig/time-series-yahoo-scatterplot-2.png" title="plot of chunk time-series-yahoo-scatterplot" alt="plot of chunk time-series-yahoo-scatterplot" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 수익률</span>

korea_stocks_diff &lt;-<span class="st"> </span><span class="kw">diff</span>(<span class="kw">log</span>(korea_stocks), <span class="dt">diff=</span><span class="dv">1</span>)

<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))

xts::<span class="kw">plot.xts</span>(korea_stocks_diff)</code></pre></div>
<pre class="output"><code>Warning in xts::plot.xts(korea_stocks_diff): only the univariate series
will be plotted
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">korea_stocks_diff_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(korea_stocks_diff)

<span class="kw">plot</span>(korea_stocks_diff_df$Samsung, korea_stocks_diff_df$Naver)
<span class="kw">abline</span>(<span class="dt">a=</span><span class="fl">0.00002607821</span>, <span class="dt">b=</span><span class="fl">0.22059696365</span>, <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>)</code></pre></div>
<p><img src="fig/time-series-yahoo-scatterplot-3.png" title="plot of chunk time-series-yahoo-scatterplot" alt="plot of chunk time-series-yahoo-scatterplot" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(korea_stocks_diff_df$Samsung, korea_stocks_diff_df$Naver, <span class="dt">ylim=</span><span class="kw">c</span>(-<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="dt">xlim=</span><span class="kw">c</span>(-<span class="fl">0.05</span>, <span class="fl">0.05</span>))
<span class="kw">abline</span>(<span class="dt">a=</span><span class="fl">0.00002607821</span>, <span class="dt">b=</span><span class="fl">0.22059696365</span>, <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>)</code></pre></div>
<p><img src="fig/time-series-yahoo-scatterplot-4.png" title="plot of chunk time-series-yahoo-scatterplot" alt="plot of chunk time-series-yahoo-scatterplot" style="display: block; margin: auto;" /></p>
<h3 id="시계열-데이터-상관계수">시계열 데이터 상관계수</h3>
<p>삼성전자와 네이버 두 회사 주가 및 주식수익률에 대한 상관계수도 계산할 수 있다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(korea_stocks)</code></pre></div>
<pre class="output"><code>          Samsung     Naver
Samsung 1.0000000 0.8518946
Naver   0.8518946 1.0000000
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(korea_stocks_diff )</code></pre></div>
<pre class="output"><code>        Samsung Naver
Samsung       1    NA
Naver        NA     1
</code></pre>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="http://blog.revolutionanalytics.com/2015/08/plotting-time-series-in-r.html">Plotting Time Series in R using Yahoo Finance data</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
